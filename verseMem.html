<!DOCTYPE html>
<html>
<title>VerseMem</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Roboto'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
html,body,h1,h2,h3,h4,h5,h6 {font-family: "Roboto", sans-serif}



/* Dropdown Button */
.dropbtn {
  background-color: #607d8b;
  color: white;
  padding-bottom: 20px;
  font-size: 16px;
  border: none;
}

/* The container <div> - needed to position the dropdown content */
.dropdown {

}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  margin-left: 10%;
  display: none;
  position: absolute;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

/* Change color of dropdown links on hover */
.dropdown-content a:hover {background-color: #ddd;}

/* Show the dropdown menu on hover */
.dropdown:hover .dropdown-content {display: block;}

</style>

<body class="w3-light-grey">


<!-- Page Container -->
<div class="w3-content w3-margin-top" style="max-width:1400px;">

  <!-- The Grid -->
  <div class="w3-row-padding">
      <div id="help" class="w3-white w3-text-grey w3-card-4">
        <div class="w3-container">
          <p class="w3-large"><b><i class="fa fa-asterisk fa-fw w3-margin-right w3-text-blue-grey"></i>VerseMem</b></p>
          <p>This is a program that helps with memorizing scripture. To use it, select a passage, hit memorize, then just start typing the first letter of each word in the given passage. For example, with Psalm 27, the correct keystroke sequence begins with 't', 'l', 'i', 'm', 'l' (corresponding to "The LORD is my light").</p><br>
        </div>
      </div>
    <br>
    <!-- Left Column -->
    <div class="w3-third">
      <div class="w3-white w3-text-grey w3-card-4">
        <div class="w3-container">
          <h3 class="w3-large"><b><i class="fa fa-asterisk fa-fw w3-margin-right w3-text-blue-grey"></i>Passage Selection</b></h3>
          <label class="w3-half" for="ver">Version:</label>
          <select id="ver" name="ver">
            <option value="KJV">KJV</option>
            <option value="ESV">ESV</option>
            <option value="DARBY">DARBY</option>
            <option value="YLT">YLT</option>
            <option value="RVA">RVA (ESP)</option>
            <option value="bb-sbb-rusbt">RUSB (РУС)</option>
          </select>
            <div class="w3-half">
                <p><b>Old Testament</b></p>
                <input type="radio" id="Genesis" name="book" value="Genesis">
                <label for="Genesis">Genesis</label><br>
                <input type="radio" id="Exodus" name="book" value="Exodus">
                <label for="Exodus">Exodus</label><br>
                <input type="radio" id="Leviticus" name="book" value="Leviticus">
                <label for="Leviticus">Leviticus</label><br>
                <input type="radio" id="Numbers" name="book" value="Numbers">
                <label for="Numbers">Numbers</label><br>
                <input type="radio" id="Deuteronomy" name="book" value="Deuteronomy">
                <label for="Deuteronomy">Deuteronomy</label><br>
                <input type="radio" id="Joshua" name="book" value="Joshua">
                <label for="Joshua">Joshua</label><br>
                <input type="radio" id="Judges" name="book" value="Judges">
                <label for="Judges">Judges</label><br>
                <input type="radio" id="Ruth" name="book" value="Ruth">
                <label for="Ruth">Ruth</label><br>
                <input type="radio" id="1_Samuel" name="book" value="1_Samuel">
                <label for="1_Samuel">1 Samuel</label><br>
                <input type="radio" id="2_Samuel" name="book" value="2_Samuel">
                <label for="2_Samuel">2 Samuel</label><br>
                <input type="radio" id="1_Kings" name="book" value="1_Kings">
                <label for="1_Kings">1 Kings</label><br>
                <input type="radio" id="2_Kings" name="book" value="2_Kings">
                <label for="2_Kings">2 Kings</label><br>
                <input type="radio" id="1_Chronicles" name="book" value="1_Chronicles">
                <label for="1_Chronicles">1 Chronicles</label><br>
                <input type="radio" id="2_Chronicles" name="book" value="2_Chronicles">
                <label for="2_Chronicles">2 Chronicles</label><br>
                <input type="radio" id="Ezra" name="book" value="Ezra">
                <label for="Ezra">Ezra</label><br>
                <input type="radio" id="Nehemiah" name="book" value="Nehemiah">
                <label for="Nehemiah">Nehemiah</label><br>
                <input type="radio" id="Esther" name="book" value="Esther">
                <label for="Esther">Esther</label><br>
                <input type="radio" id="Job" name="book" value="Job">
                <label for="Job">Job</label><br>
                <input type="radio" id="Psalms" name="book" value="Psalms">
                <label for="psalms">Psalms</label><br>
                <input type="radio" id="Proverbs" name="book" value="Proverbs">
                <label for="Proverbs">Proverbs</label><br>
                <input type="radio" id="Ecclesiastes" name="book" value="Ecclesiastes">
                <label for="Ecclesiastes">Ecclesiastes</label><br>
                <input type="radio" id="Song_Of_Solomon" name="book" value="Song_Of_Solomon">
                <label for="Song_Of_Solomon">Song Of Solomon</label><br>
                <input type="radio" id="Isaiah" name="book" value="Isaiah">
                <label for="isaiah">Isaiah</label><br>
                <input type="radio" id="Jeremiah" name="book" value="Jeremiah">
                <label for="Jeremiah">Jeremiah</label><br>
                <input type="radio" id="Lamentations" name="book" value="Lamentations">
                <label for="Lamentations">Lamentations</label><br>
                <input type="radio" id="Ezekiel" name="book" value="Ezekiel">
                <label for="Ezekiel">Ezekiel</label><br>
                <input type="radio" id="Daniel" name="book" value="Daniel">
                <label for="Daniel">Daniel</label><br>
                <input type="radio" id="Hosea" name="book" value="Hosea">
                <label for="Hosea">Hosea</label><br>
                <input type="radio" id="Joel" name="book" value="Joel">
                <label for="Joel">Joel</label><br>
                <input type="radio" id="Amos" name="book" value="Amos">
                <label for="Amos">Amos</label><br>
                <input type="radio" id="Obadiah" name="book" value="Obadiah">
                <label for="Obadiah">Obadiah</label><br>
                <input type="radio" id="Jonah" name="book" value="Jonah">
                <label for="Jonah">Jonah</label><br>
                <input type="radio" id="Micah" name="book" value="Micah">
                <label for="Micah">Micah</label><br>
                <input type="radio" id="Nahum" name="book" value="Nahum">
                <label for="Nahum">Nahum</label><br>
                <input type="radio" id="Habakkuk" name="book" value="Habakkuk">
                <label for="Habakkuk">Habakkuk</label><br>
                <input type="radio" id="Zephaniah" name="book" value="Zephaniah">
                <label for="Zephaniah">Zephaniah</label><br>
                <input type="radio" id="Haggai" name="book" value="Haggai">
                <label for="Haggai">Haggai</label><br>
                <input type="radio" id="Zechariah" name="book" value="Zechariah">
                <label for="Zechariah">Zechariah</label><br>
                <input type="radio" id="Malachi" name="book" value="Malachi">
                <label for="Malachi">Malachi</label><br><br>
            </div>
            <div class="w3-half">
                <p><b>New Testament</b></p>
                <input type="radio" id="Matthew" name="book" value="Matthew">
                <label for="Matthew">Matthew</label><br>
                <input type="radio" id="Mark" name="book" value="Mark">
                <label for="Mark">Mark</label><br>
                <input type="radio" id="Luke" name="book" value="Luke">
                <label for="Luke">Luke</label><br>
                <input type="radio" id="John" name="book" value="John">
                <label for="John">John</label><br>
                <input type="radio" id="Acts" name="book" value="Acts">
                <label for="Acts">Acts</label><br>
                <input type="radio" id="Romans" name="book" value="Romans">
                <label for="Romans">Romans</label><br>
                <input type="radio" id="1_Corinthians" name="book" value="1_Corinthians">
                <label for="1_Corinthians">1 Corinthians</label><br>
                <input type="radio" id="2_Corinthians" name="book" value="2_Corinthians">
                <label for="2_Corinthians">2 Corinthians</label><br>
                <input type="radio" id="Galatians" name="book" value="Galatians">
                <label for="Galatians">Galatians</label><br>
                <input type="radio" id="Ephesians" name="book" value="Ephesians">
                <label for="Ephesians">Ephesians</label><br>
                <input type="radio" id="Philippians" name="book" value="Philippians">
                <label for="Philippians">Philippians</label><br>
                <input type="radio" id="Colossians" name="book" value="Colossians">
                <label for="Colossians">Colossians</label><br>
                <input type="radio" id="1_Thessalonians" name="book" value="1_Thessalonians">
                <label for="1_Thessalonians">1 Thessalonians</label><br>
                <input type="radio" id="2_Thessalonians" name="book" value="2_Thessalonians">
                <label for="2_Thessalonians">2 Thessalonians</label><br>
                <input type="radio" id="1_Timothy" name="book" value="1_Timothy">
                <label for="1_Timothy">1 Timothy</label><br>
                <input type="radio" id="2_Timothy" name="book" value="2_Timothy">
                <label for="2_Timothy">2 Timothy</label><br>
                <input type="radio" id="Titus" name="book" value="Titus">
                <label for="Titus">Titus</label><br>
                <input type="radio" id="Philemon" name="book" value="Philemon">
                <label for="Philemon">Philemon</label><br>
                <input type="radio" id="Hebrews" name="book" value="Hebrews">
                <label for="Hebrews">Hebrews</label><br>
                <input type="radio" id="James" name="book" value="James">
                <label for="James">James</label><br>
                <input type="radio" id="1_Peter" name="book" value="1_Peter">
                <label for="1_Peter">1 Peter</label><br>
                <input type="radio" id="2_Peter" name="book" value="2_Peter">
                <label for="2_Peter">2 Peter</label><br>
                <input type="radio" id="1_John" name="book" value="1_John">
                <label for="1_John">1 John</label><br>
                <input type="radio" id="2_John" name="book" value="2_John">
                <label for="2_John">2 John</label><br>
                <input type="radio" id="3_John" name="book" value="3_John">
                <label for="3_John">3 John</label><br>
                <input type="radio" id="Jude" name="book" value="Jude">
                <label for="Jude">Jude</label><br>
                <input type="radio" id="Revelation" name="book" value="Revelation">
                <label for="Revelation">Revelation</label><br>
                <hr>
                <p><b>Chapter Number</b></p>
                <input type="number" id="chptNum" name="number" min="1" max="150" required></input>
                <br>
                <hr>
                <p style="margin-bottom: 3px;"><b>Verse Numbers</b></p>
                <label for "verseNums">e.g. "3" or "2-7" or leave blank for whole chapter</label>
                <input style="width: 40%; display: block;" type="text" id="verseNums" required></input>
                <br>
                <input type="button" onclick="console.log('read'); isReading = true; loadPassage();" value="Read"></input>
                <input type="button" onclick="console.log('memorize'); isReading = false; loadPassage();" value="Memorize"></input>
                <br><br>
            </div>
          <br>
          <br>
        </div>
      </div><br>

    <!-- End Left Column -->
    </div>

    <!-- Right Column -->
    <div class="w3-twothird">
      <div class="w3-container w3-card w3-white w3-margin-bottom">
        <h2 class="w3-text-grey w3-padding-16" id="chptTitle"><i class="fa fa-book fa-fw w3-margin-right w3-xxlarge w3-text-blue-grey"></i></h2>
	  <div class="w3-container">
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	  <p id="verse2"></p>
	  <p id="result"></p>
	  </div>
      </div>
    <!-- End Right Column -->
    </div>

  <!-- End Grid -->
  </div>

  <!-- End Page Container -->
</div>

<footer class="w3-container w3-blue-grey w3-center w3-margin-top">
  <br>
  <p>Created by Ben Garcia. Find me on social media:</p>
  <a href="https://www.facebook.com/ben.garcia.7/"><i class="fa fa-facebook-official w3-hover-opacity"></i></a>
  <a href="https://www.instagram.com/benryangarcia/"><i class="fa fa-instagram w3-hover-opacity"></i></a>
  <a href="https://github.com/Benjamin-Ryan-Garcia"><i class="fa fa-github w3-hover-opacity"></i></a>
  <p></p>
</footer>

<script>
//passage selection stuff
var bookName = "Psalms"
var chptNum = 1;
var ver = "KJV"
var firstVerse = 0;
var lastVerse = 0;
var verseNums = [];
var isReading = false;

function loadPassage(){
    $('#help').css("display", "none");
    var verEl = $("#ver");
    ver = verEl.val();
    console.log(ver);
    var bookNameEl = $("input[name='book']:checked");
    bookName = bookNameEl.val();
    var chptNumEl = $('#chptNum');
    chptNum = chptNumEl.val();
    var verseNumsEl = $('#verseNums');
    var verseNumsString = verseNumsEl.val();
    if(verseNumsString == ""){
        firstVerse = 1;
        lastVerse = 178;
    }
    else if(verseNumsString.indexOf("-") != -1){
        firstVerse = verseNumsString.substring(0, verseNumsString.indexOf("-"));
        lastVerse = verseNumsString.substring(verseNumsString.indexOf("-")+1);
        if(ver == "ESV") lastVerse++;
    }
    else{
        firstVerse = verseNumsString;
        lastVerse = firstVerse;
        if(ver == "ESV") lastVerse++;
    }
    for(var i = firstVerse; i <= lastVerse; i++){
        verseNums.push(i);
    }
    console.log(bookName);
    console.log(chptNum);
    document.getElementById("chptTitle").innerHTML = ("<i class=\"fa fa-book fa-fw w3-margin-right w3-xxlarge w3-text-blue-grey\"></i>" + bookName.replace("_", " ") + " " + chptNum);
    wikiCors();
    waitForIt();
}
</script>

<script>
    function createCORSRequest(method, url){
        var xhr = new XMLHttpRequest();
        if ("withCredentials" in xhr){
            xhr.open(method, url, true);
        } else if (typeof XDomainRequest != "undefined"){
            xhr = new XDomainRequest();
            xhr.open(method, url);
        } else {
            xhr = null;
        }

        //esv api key
        if(ver == "ESV") xhr.setRequestHeader("Authorization", "3edfd010e9199bd553aabdfc5c3ea53b807fe012");
        return xhr;
    }

    var wikiParse = "";
    var pause = true;

    function wikiCors(){
        var url = "";
        if(ver == "ESV"){
            //key: 3edfd010e9199bd553aabdfc5c3ea53b807fe012
            url = "https://api.esv.org/v3/passage/text/?q=" + bookName + "+" + chptNum + "&include-footnotes=false&include-footnote-body=false&include-headings=false";
        }
        else{
            //url = "https://en.wikisource.org/w/api.php?action=parse&page=Bible_(King_James)/" + bookName + "&section=" + chptNum + "&format=json&origin=*";
            //key: 5e35292ee138d5d6e3a45a55bf699271
            url = "https://api.biblia.com/v1/bible/content/" + ver + ".txt.txt?passage=" + bookName + chptNum + "&style=oneVersePerLine&key=5e35292ee138d5d6e3a45a55bf699271";
        }
        console.log(url);
        var request = createCORSRequest("get", url);
        if (request){
            request.onload = function(){
                wikiParse = "";
                var pointerElement = $('#verse2');
                pointerElement.html("");
                verseIndex = 0;
                wordIndex = 0;
                wikiParse = request.responseText;
                console.log(wikiParse);
                pause = false;
            };
            request.send();
        }
    }
</script>

<script>
    //initialize variables
    var wordCount = 0;
    var wordIndex = 0;
    var verseIndex = 0;
    var passage = "";
    var words;
    var verses;
    var elements;

    //stat variables
    var incorrectStroke = 0;
    var incorrectStrokes = 0;
    var correctStrokes = 0;
    var complete = false;

    function cleanWikiParseStandard(){
        var nxtVer = lastVerse * 1.0 + 1.0;
        wikiParse = wikiParse.substring(wikiParse.indexOf("\r\n" + firstVerse) + 3);
        if(wikiParse.indexOf(nxtVer) != -1){
            wikiParse = wikiParse.substring(0, wikiParse.indexOf(nxtVer));
        }
		wikiParse = wikiParse.replaceAll(" \r\n", "+");
		wikiParse = wikiParse.replaceAll("\\\\u201.", "");
		wikiParse = wikiParse.replace(/[0-9]/g, '');
		wikiParse = wikiParse.substring(0, wikiParse.length-1);
		passage = wikiParse.trim();

		console.log(passage);
    }

    function cleanWikiParseESV(){
        var temp = 0;
        var temp2 = 0;
        wikiParse = wikiParse.substring(wikiParse.indexOf("[1]"), wikiParse.indexOf("(ESV)"));
        wikiParse = wikiParse.substring(wikiParse.indexOf("[" + firstVerse + "]"));
        if(wikiParse.indexOf("[" + lastVerse + "]") != -1){
            wikiParse = wikiParse.substring(0, wikiParse.indexOf("[" + lastVerse + "]"));
        }
		wikiParse = wikiParse.replaceAll(/\\n/g, "");
		wikiParse = wikiParse.replaceAll(/\s\s+/g, ' ');

		while(wikiParse.indexOf("\\u201") != -1){
		    temp = wikiParse.indexOf("\\u201");
		    wikiParse = wikiParse.substring(0, temp) + wikiParse.substring(temp+6);
		}

		while(wikiParse.indexOf("[") != -1){
		    temp = wikiParse.indexOf("[");
		    temp2 = wikiParse.indexOf("]");
		    wikiParse = wikiParse.substring(0, temp) + "+" + wikiParse.substring(temp2+2);
		}
		wikiParse = wikiParse.replaceAll(" +", "+");
		wikiParse = wikiParse.substring(1);
		passage = wikiParse.trim();

		console.log(passage);
    }

    function waitForIt(){

        console.log("waiting");
        if (pause) {
            //change this back to 100
            setTimeout(function(){waitForIt()},100);
        } else {
            pause = true;
            passage = "";
            incorrectStroke = 0;
            incorrectStrokes = 0;
            correctStrokes = 0;
            complete = false;
            if(ver == "ESV") cleanWikiParseESV();
            else cleanWikiParseStandard();
            verses = passage.split('+');
            words = verses.map(function(verse) {
                return verse.split(" ");
            });

            var verseNum = firstVerse;
            elements = words.map(function(verse){
                var temp = verse.map(function(word){
                    return $('<span id="' + word + '">' + word + ' ' + '</span>');
                });
                temp[0] = $('<span id="' + verse[0] + '"><b>' + verseNum + ')</b> ' + verse[0] + ' ' + '</span>'); //adds verse number to start of line
                temp[temp.length - 1] = $('<span id="' + verse[verse.length - 1] + '">' + verse[verse.length - 1] + '<br>' + '</span>'); //adds a newline after each verse
                verseNum++;
                return temp;
            });

            if(isReading){
                for(var j = firstVerse; j <= lastVerse; j++){
                    for(var k = 0; k < words[j-1].length; k++){
                        $('#verse2').append(elements[j-1][k]);
                    }
                }
            }
        };
    }

    function isLetter(str) {
        return str.length === 1 && str.match(/[a-z]/i);
    }

    var pointerElement = $('#verse2');
    var incorrectEl = $('<span style="color: red; id="incorrectEl">incorrect</span>');

    document.addEventListener('keypress', function(event) {
    	var key = String.fromCharCode(event.keyCode).toLowerCase();
    	if(key == " ") return;
        var correctKey = words[verseIndex][wordIndex].charAt(0).toLowerCase();
        console.log(correctKey);
        console.log(key);
        if(!isLetter(correctKey) && ver != "bb-sbb-rusbt"){ console.log("using 2nd char"); correctKey = words[verseIndex][wordIndex].charAt(1).toLowerCase(); }

        if((!isLetter(key) && ver != "bb-sbb-rusbt") || isReading || complete){ console.log("user entered illegal character"); return; }

        if(key == correctKey){
            incorrectStroke = 0;
            correctStrokes+=3;
            pointerElement.append(elements[verseIndex][wordIndex]);
            elements[verseIndex][wordIndex].hide();
            elements[verseIndex][wordIndex].fadeIn(300);
            wordIndex++;
            wordCount++;
            if(wordIndex >= words[verseIndex].length){ verseIndex++; wordIndex = 0;}
            if(verseIndex >= words.length){
                complete = true;
                console.log(correctStrokes);
                console.log(incorrectStrokes);
                var accuracy = Number.parseFloat(((correctStrokes-incorrectStrokes) / correctStrokes) * 100).toPrecision(4);
                pointerElement.append($('<p class="w3-text-grey"><b>Accuracy:</b></p><div class="w3-light-grey w3-round-xlarge w3-small"><div class="w3-container w3-center w3-round-xlarge w3-blue-grey" style="width:' + accuracy + '%">' + accuracy + '%</div></div>'));
            }
        }
        else{
            incorrectStroke++;
            incorrectStrokes++;
            if(incorrectStroke == 3){
                incorrectStroke = 0;
                correctStrokes++;
                pointerElement.append(elements[verseIndex][wordIndex]);
                elements[verseIndex][wordIndex].hide();
                elements[verseIndex][wordIndex].fadeIn(300);
                elements[verseIndex][wordIndex].css("color", "red");
                wordIndex++;
                wordCount++;
                if(wordIndex >= words[verseIndex].length){ verseIndex++; wordIndex = 0; }
            }
            else{
                incorrectEl.remove();
                incorrectEl.fadeIn(0);
                incorrectEl.css("opacity", "100");
                pointerElement.append(incorrectEl);
                incorrectEl.fadeOut(300);
            }
        }
    });

</script>
</body>
</html>
